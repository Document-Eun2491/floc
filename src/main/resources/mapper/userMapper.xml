<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.app.floc.mapper.UserMapper">

    <!--회원가입-->
    <insert id="insert">
        INSERT INTO TBL_USER
        (ID, USER_IDENTIFICATION, USER_PASSWORD, USER_NAME, USER_NICKNAME)
        VALUES(SEQ_USER.NEXTVAL, #{userIdentification}, #{userPassword}, #{userName}, #{userNickname})
    </insert>

    <!--입력한 회원 identification으로 회원 조회-->
    <select id="selectByUserIdentification" resultType="userVO">
        SELECT ID, USER_IDENTIFICATION, USER_PASSWORD, USER_NAME, USER_NICKNAME, USER_STATUS, USER_TISSUE, USER_CREATED_DATE, USER_UPDATED_DATE, USER_ROLE, PROFIL_IMAGE_NAME, PROFIL_IMAGE_UUID, PROFIL_IMAGE_SIZE
        FROM TBL_USER
        WHERE USER_IDENTIFICATION = #{userIdentification}
    </select>

    <!--회원 id로 회원 조회-->
    <select id="selectByUserId" resultType="userVO">
        SELECT ID, USER_IDENTIFICATION, USER_PASSWORD, USER_NAME, USER_NICKNAME, USER_STATUS, USER_TISSUE, USER_CREATED_DATE, USER_UPDATED_DATE, USER_ROLE, PROFIL_IMAGE_NAME, PROFIL_IMAGE_UUID, PROFIL_IMAGE_SIZE
        FROM TBL_USER
        WHERE ID = #{userId}
    </select>



    <!--회원 전체 목록 조회 admin에서-->
    <sql id="search">
        <if test="search.type != null and !search.type.equals('')">
            <foreach item="type" collection="search.types">
                <choose>
                    <when test="type == 'n'.toString()">
                        AND (USER_NAME LIKE '%'||#{search.keyword}||'%')
                    </when>
                    <when test="type == 'i'.toString()">
                        AND (USER_NICKNAME LIKE '%'||#{search.keyword}||'%')
                    </when>
                </choose>
            </foreach>
        </if>
    </sql>

    <select id="selectAll" resultType="userVO">
        SELECT ID, USER_IDENTIFICATION, USER_NICKNAME, USER_NAME, USER_ROLE, USER_TISSUE, USER_CREATED_DATE
        FROM
        (
        SELECT ROWNUM R, U.ID, USER_IDENTIFICATION, USER_NICKNAME, USER_NAME, USER_ROLE, USER_TISSUE, USER_CREATED_DATE
        FROM TBL_USER U
        <![CDATA[
    WHERE ROWNUM <= #{pagination.page} * #{pagination.rowCount}
    ]]>
        <include refid="search"/>
        ORDER BY ID ASC
        <![CDATA[
) WHERE R > (#{pagination.page} - 1) * #{pagination.rowCount}
]]>
    </select>

    <select id="selectCountOfUser" resultType="_int">
        SELECT COUNT(ID) FROM TBL_USER
        WHERE 1=1
        <include refid="search"/>
    </select>
</mapper>



